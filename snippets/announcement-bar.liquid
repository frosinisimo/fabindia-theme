{%- comment -%}
================================================================
FABINDIA ROMA - ANNOUNCEMENT-BAR.LIQUID (SIMPLIFIED)
Snippet di rendering ottimizzato
================================================================
{%- endcomment -%}

{%- assign has_announcements = false -%}
{%- for block in section.blocks -%}
  {%- if block.type == 'announcement' -%}
    {%- assign has_announcements = true -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- assign should_hide = false -%}
{%- if section.settings.hide_pages != blank -%}
  {%- assign hide_list = section.settings.hide_pages | split: ',' -%}
  {%- assign current_id = request.page_type | append: '-' | append: template.suffix | append: '-' | append: product.id | append: collection.id | append: page.id -%}
  
  {%- for page_id in hide_list -%}
    {%- assign clean_id = page_id | strip -%}
    {%- if current_id contains clean_id -%}
      {%- assign should_hide = true -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- if has_announcements and should_hide == false -%}
<style>
  #shopify-section-{{ section.id }} {
    --ann-bg: {{ section.settings.background_color }};
    --ann-text: {{ section.settings.text_color }};
    --ann-border: {{ section.settings.border_color }};
    --ann-border-width: {{ section.settings.border_width }}px;
    --ann-padding: {{ section.settings.padding_y }}px;
    --ann-font-weight: {{ section.settings.font_weight }};
    --ann-font-desktop: {{ section.settings.font_desktop }}px;
    --ann-font-mobile: {{ section.settings.font_mobile }}px;
    
    {%- if section.settings.enable_hover -%}
    --ann-bg-hover: {{ section.settings.bg_hover }};
    --ann-text-hover: {{ section.settings.text_hover }};
    --ann-border-hover: {{ section.settings.border_hover }};
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .announcement-bar {
    background: var(--ann-bg);
    color: var(--ann-text);
    border-bottom: var(--ann-border-width) solid var(--ann-border);
    padding: var(--ann-padding) 0;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .announcement-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    max-width: var(--wrapper-width);
    margin: 0 auto;
    padding: 0 20px;
  }

  #shopify-section-{{ section.id }} .announcement-item {
    font-weight: var(--ann-font-weight);
    font-size: var(--ann-font-desktop);
    color: var(--ann-text);
    
    {%- if section.settings.text_shadow -%}
      {%- case section.settings.shadow_level -%}
        {%- when 'light' -%}
          text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        {%- when 'medium' -%}
          text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        {%- when 'strong' -%}
          text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        {%- when 'intense' -%}
          text-shadow: 4px 4px 8px rgba(0,0,0,0.4);
      {%- endcase -%}
    {%- endif -%}
  }

  #shopify-section-{{ section.id }} .announcement-link {
    color: inherit;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  #shopify-section-{{ section.id }} .announcement-link-text {
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  {%- if section.settings.enable_hover -%}
  #shopify-section-{{ section.id }} .announcement-bar:hover {
    background: var(--ann-bg-hover);
    border-color: var(--ann-border-hover);
  }

  #shopify-section-{{ section.id }} .announcement-bar:hover .announcement-item {
    color: var(--ann-text-hover);
  }
  {%- endif -%}

  {%- if section.settings.hide_desktop -%}
  @media (min-width: 768px) {
    #shopify-section-{{ section.id }} {
      display: none !important;
    }
  }
  {%- endif -%}

  @media (max-width: 767px) {
    #shopify-section-{{ section.id }} .announcement-item {
      font-size: var(--ann-font-mobile);
    }

    #shopify-section-{{ section.id }} .announcement-content {
      padding: 0 15px;
      gap: 15px;
    }

    {%- if section.settings.hide_mobile -%}
    #shopify-section-{{ section.id }} {
      display: none !important;
    }
    {%- endif -%}
  }

  {%- comment -%} Fix per garantire contrasto {%- endcomment -%}
  {%- if section.settings.background_color == section.settings.text_color -%}
  #shopify-section-{{ section.id }} .announcement-item {
    color: {%- if section.settings.background_color contains 'FFF' or section.settings.background_color contains 'fff' -%}#000000{%- else -%}#FFFFFF{%- endif -%} !important;
  }
  {%- endif -%}
</style>

<div class="announcement-bar" role="banner" aria-label="Annunci">
  <div class="announcement-content">
    {%- for block in section.blocks -%}
      {%- if block.type == 'announcement' -%}
        <div class="announcement-item" {{ block.shopify_attributes }}>
          {%- if block.settings.link != blank -%}
            <a href="{{ block.settings.link }}" class="announcement-link">
          {%- endif -%}
          
          {%- if block.settings.text != blank -%}
            <span class="announcement-text">{{ block.settings.text }}</span>
          {%- endif -%}
          
          {%- if block.settings.link_text != blank -%}
            <span class="announcement-link-text">{{ block.settings.link_text }}</span>
          {%- endif -%}
          
          {%- if block.settings.link != blank -%}
            </a>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</div>
{%- endif -%}