{% schema %}
{
  "name": "FAQ Elegante",
  "tag": "section",
  "class": "fr-faq-section",
  "settings": [
    {
      "type": "header",
      "content": "Contenuto"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Titolo Sezione",
      "default": "Domande Frequenti"
    },
    {
      "type": "richtext",
      "id": "section_subtitle",
      "label": "Sottotitolo",
      "default": "<p>Trova le risposte alle domande più comuni</p>"
    },
    {
      "type": "header",
      "content": "Design"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Sfondo Sezione",
      "default": "#FEFEFE"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Colore Titolo",
      "default": "#3E3E3E"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Colore Sottotitolo",
      "default": "#B5A397"
    },
    {
      "type": "color",
      "id": "question_color",
      "label": "Colore Domande",
      "default": "#3E3E3E"
    },
    {
      "type": "color",
      "id": "answer_color",
      "label": "Colore Risposte",
      "default": "#3E3E3E"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Colore Accento",
      "default": "#C33A32"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Colore Bordi",
      "default": "#E5DDD5"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Stile Layout",
      "options": [
        {
          "value": "minimal",
          "label": "Minimale"
        },
        {
          "value": "bordered",
          "label": "Con Bordi"
        },
        {
          "value": "cards",
          "label": "Cards"
        }
      ],
      "default": "minimal"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Colonne Desktop",
      "options": [
        {
          "value": "1",
          "label": "1 colonna"
        },
        {
          "value": "2",
          "label": "2 colonne"
        }
      ],
      "default": "1"
    },
    {
      "type": "checkbox",
      "id": "enable_accordion",
      "label": "Modalità Accordion",
      "default": true,
      "info": "Apre solo una FAQ alla volta"
    },
    {
      "type": "checkbox",
      "id": "enable_schema",
      "label": "Abilita Schema SEO",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "nascondi_mobile",
      "label": "Nascondi da Mobile",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "nascondi_desktop",
      "label": "Nascondi da Desktop",
      "default": false
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Padding Top Mobile",
      "default": 30,
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Padding Bottom Mobile",
      "default": 30,
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "label": "Padding Top Desktop",
      "default": 60,
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "label": "Padding Bottom Desktop",
      "default": 60,
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_top_mobile",
      "label": "Margin Top Mobile",
      "default": 0,
      "min": -100,
      "max": 100,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_bottom_mobile",
      "label": "Margin Bottom Mobile",
      "default": 0,
      "min": -100,
      "max": 100,
      "step": 2,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_top_desktop",
      "label": "Margin Top Desktop",
      "default": 0,
      "min": -200,
      "max": 200,
      "step": 4,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_bottom_desktop",
      "label": "Margin Bottom Desktop",
      "default": 0,
      "min": -200,
      "max": 200,
      "step": 4,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "max_dimensione",
      "label": "Larghezza Massima",
      "options": [
        {
          "value": "none",
          "label": "100%"
        },
        {
          "value": "1400px",
          "label": "1400px"
        },
        {
          "value": "1300px",
          "label": "1300px"
        },
        {
          "value": "1200px",
          "label": "1200px"
        },
        {
          "value": "1100px",
          "label": "1100px"
        },
        {
          "value": "1000px",
          "label": "1000px"
        },
        {
          "value": "900px",
          "label": "900px"
        },
        {
          "value": "800px",
          "label": "800px"
        },
        {
          "value": "700px",
          "label": "700px"
        }
      ],
      "default": "1000px"
    }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "FAQ",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Domanda",
          "default": "Inserisci la domanda"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Risposta",
          "default": "<p>Inserisci la risposta</p>"
        },
        {
          "type": "checkbox",
          "id": "initially_open",
          "label": "Aperto di default",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Elegante",
      "category": "Fabindia custom",
      "blocks": [
        {
          "type": "faq",
          "settings": {
            "question": "Quali sono i tempi di spedizione?",
            "answer": "<p>Consegniamo in tutta Italia in 2-3 giorni lavorativi. Per ordini superiori a €100 la spedizione è gratuita.</p>",
            "initially_open": true
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "I tessuti sono naturali?",
            "answer": "<p>Utilizziamo esclusivamente tessuti naturali di alta qualità: cotone puro, seta, lana e lino provenienti dall'India.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Come posso curare i miei capi?",
            "answer": "<p>Ogni capo richiede cure specifiche. Consigliamo lavaggio delicato a 30°, asciugatura all'ombra e stiratura a bassa temperatura.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<style>
  /* Base Styles */
  @media only screen and (min-width: 769px) {
    #shopify-section-{{ section.id }} {
      max-width: {{ section.settings.max_dimensione }};
      margin: 0 auto;
      padding-top: {{ section.settings.padding_top_desktop }}px;
      padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
      margin-top: {{ section.settings.margin_top_desktop }}px;
      margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
    }
    
    {% if section.settings.nascondi_desktop %}
      #shopify-section-{{ section.id }} {
        display: none;
      }
    {% endif %}
  }

  @media only screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top_mobile }}px;
      padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
      margin-top: {{ section.settings.margin_top_mobile }}px;
      margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
    }
    
    {% if section.settings.nascondi_mobile %}
      #shopify-section-{{ section.id }} {
        display: none;
      }
    {% endif %}
  }

  /* Section Styles */
  #shopify-section-{{ section.id }} .fr-faq-wrapper {
    background: {{ section.settings.background_color }};
    position: relative;
  }

  #shopify-section-{{ section.id }} .fr-faq-container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 2rem;
  }

  /* Header Styles */
  #shopify-section-{{ section.id }} .fr-faq-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  #shopify-section-{{ section.id }} .fr-faq-title {
    font-family: var(--typeHeaderPrimary);
    font-size: 2.5rem;
    font-weight: 400;
    color: {{ section.settings.title_color }};
    margin: 0 0 1rem;
    letter-spacing: -0.02em;
    line-height: 1.2;
  }

  #shopify-section-{{ section.id }} .fr-faq-subtitle {
    font-family: var(--typeBasePrimary);
    font-size: 1.125rem;
    color: {{ section.settings.subtitle_color }};
    margin: 0;
    line-height: 1.6;
  }

  #shopify-section-{{ section.id }} .fr-faq-subtitle p {
    margin: 0;
  }

  /* Grid Layout */
  #shopify-section-{{ section.id }} .fr-faq-grid {
    display: grid;
    gap: 2rem;
    {% if section.settings.columns_desktop == '2' %}
      grid-template-columns: repeat(2, 1fr);
    {% else %}
      grid-template-columns: 1fr;
    {% endif %}
  }

  /* FAQ Item Styles */
  #shopify-section-{{ section.id }} .fr-faq-item {
    {% if section.settings.layout_style == 'minimal' %}
      border-bottom: 1px solid {{ section.settings.border_color }};
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
    {% elsif section.settings.layout_style == 'bordered' %}
      border: 1px solid {{ section.settings.border_color }};
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    {% else %}
      background: #fff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
      transition: box-shadow 0.3s ease;
    {% endif %}
  }

  {% if section.settings.layout_style == 'cards' %}
  #shopify-section-{{ section.id }} .fr-faq-item:hover {
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }
  {% endif %}

  #shopify-section-{{ section.id }} .fr-faq-item:last-child {
    {% if section.settings.layout_style == 'minimal' %}
      border-bottom: none;
      margin-bottom: 0;
    {% endif %}
  }

  /* Question Styles */
  #shopify-section-{{ section.id }} .fr-faq-question-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: 0.5rem 0;
    transition: all 0.3s ease;
  }

  #shopify-section-{{ section.id }} .fr-faq-question {
    font-family: var(--typeBasePrimary);
    font-size: 1.125rem;
    font-weight: 500;
    color: {{ section.settings.question_color }};
    margin: 0;
    flex: 1;
    line-height: 1.5;
    padding-right: 2rem;
  }

  #shopify-section-{{ section.id }} .fr-faq-item[aria-expanded="true"] .fr-faq-question {
    color: {{ section.settings.accent_color }};
  }

  /* Icon Styles */
  #shopify-section-{{ section.id }} .fr-faq-icon {
    width: 24px;
    height: 24px;
    position: relative;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  #shopify-section-{{ section.id }} .fr-faq-icon::before,
  #shopify-section-{{ section.id }} .fr-faq-icon::after {
    content: '';
    position: absolute;
    background: {{ section.settings.accent_color }};
    transition: all 0.3s ease;
  }

  #shopify-section-{{ section.id }} .fr-faq-icon::before {
    width: 14px;
    height: 1.5px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  #shopify-section-{{ section.id }} .fr-faq-icon::after {
    width: 1.5px;
    height: 14px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 1;
  }

  #shopify-section-{{ section.id }} .fr-faq-item[aria-expanded="true"] .fr-faq-icon {
    transform: rotate(45deg);
  }

  #shopify-section-{{ section.id }} .fr-faq-item[aria-expanded="true"] .fr-faq-icon::after {
    opacity: 0;
  }

  /* Answer Styles */
  #shopify-section-{{ section.id }} .fr-faq-answer {
    font-family: var(--typeBasePrimary);
    font-size: 1rem;
    color: {{ section.settings.answer_color }};
    line-height: 1.7;
    overflow: hidden;
    height: 0;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #shopify-section-{{ section.id }} .fr-faq-answer-content {
    padding-top: 1rem;
  }

  #shopify-section-{{ section.id }} .fr-faq-answer p {
    margin: 0 0 0.75rem;
  }

  #shopify-section-{{ section.id }} .fr-faq-answer p:last-child {
    margin-bottom: 0;
  }

  #shopify-section-{{ section.id }} .fr-faq-item[aria-expanded="true"] .fr-faq-answer {
    height: auto;
    opacity: 1;
  }

  /* Mobile Styles */
  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} .fr-faq-container {
      padding: 0 1rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-header {
      margin-bottom: 2.5rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-title {
      font-size: 1.875rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-subtitle {
      font-size: 1rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-question {
      font-size: 1rem;
      padding-right: 1.5rem;
    }

    #shopify-section-{{ section.id }} .fr-faq-answer {
      font-size: 0.9375rem;
    }

    {% if section.settings.layout_style == 'cards' %}
    #shopify-section-{{ section.id }} .fr-faq-item {
      padding: 1.5rem;
    }
    {% endif %}
  }
</style>

<section class="fr-faq-wrapper">
  <div class="fr-faq-container">
    {% if section.settings.section_title != blank or section.settings.section_subtitle != blank %}
      <div class="fr-faq-header">
        {% if section.settings.section_title != blank %}
          <h2 class="fr-faq-title">{{ section.settings.section_title }}</h2>
        {% endif %}
        {% if section.settings.section_subtitle != blank %}
          <div class="fr-faq-subtitle">{{ section.settings.section_subtitle }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="fr-faq-grid" itemscope itemtype="https://schema.org/FAQPage">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'faq' %}
            <div class="fr-faq-item" 
                 aria-expanded="{{ block.settings.initially_open }}"
                 itemscope 
                 itemprop="mainEntity" 
                 itemtype="https://schema.org/Question"
                 {{ block.shopify_attributes }}>
              <div class="fr-faq-question-wrapper" 
                   role="button" 
                   tabindex="0" 
                   aria-controls="faq-answer-{{ block.id }}"
                   aria-label="{{ block.settings.question }}">
                <h3 class="fr-faq-question" itemprop="name">{{ block.settings.question }}</h3>
                <div class="fr-faq-icon" aria-hidden="true"></div>
              </div>
              <div class="fr-faq-answer" 
                   id="faq-answer-{{ block.id }}"
                   itemscope 
                   itemprop="acceptedAnswer" 
                   itemtype="https://schema.org/Answer">
                <div class="fr-faq-answer-content" itemprop="text">
                  {{ block.settings.answer }}
                </div>
              </div>
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</section>

{% if section.settings.enable_schema %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for block in section.blocks %}
      {% if block.type == 'faq' %}
        {
          "@type": "Question",
          "name": {{ block.settings.question | json }},
          "acceptedAnswer": {
            "@type": "Answer",
            "text": {{ block.settings.answer | strip_html | json }}
          }
        }{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  const section = document.getElementById(`shopify-section-${sectionId}`);
  const faqItems = section.querySelectorAll('.fr-faq-item');
  const enableAccordion = {{ section.settings.enable_accordion | json }};
  
  faqItems.forEach(item => {
    const questionWrapper = item.querySelector('.fr-faq-question-wrapper');
    const answer = item.querySelector('.fr-faq-answer');
    const isInitiallyOpen = item.getAttribute('aria-expanded') === 'true';
    
    // Set initial state
    if (isInitiallyOpen) {
      answer.style.height = 'auto';
      answer.style.opacity = '1';
    }
    
    function toggleFaq() {
      const isExpanded = item.getAttribute('aria-expanded') === 'true';
      
      // Close others if accordion mode
      if (enableAccordion && !isExpanded) {
        faqItems.forEach(otherItem => {
          if (otherItem !== item && otherItem.getAttribute('aria-expanded') === 'true') {
            const otherAnswer = otherItem.querySelector('.fr-faq-answer');
            otherItem.setAttribute('aria-expanded', 'false');
            otherAnswer.style.height = '0';
            otherAnswer.style.opacity = '0';
          }
        });
      }
      
      // Toggle current item
      if (isExpanded) {
        item.setAttribute('aria-expanded', 'false');
        answer.style.height = '0';
        answer.style.opacity = '0';
      } else {
        item.setAttribute('aria-expanded', 'true');
        answer.style.height = 'auto';
        answer.style.opacity = '1';
        
        // Smooth scroll to item if needed
        const rect = item.getBoundingClientRect();
        if (rect.top < 0 || rect.bottom > window.innerHeight) {
          item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    }
    
    // Event listeners
    questionWrapper.addEventListener('click', toggleFaq);
    
    questionWrapper.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleFaq();
      }
    });
  });
});
</script>